.TH MONTHLY_WFS 1 "$Date$"
.SH NAME
monthly_wfs \- build wfdiscs for monthly event databases and append to year waveform databases
.SH SYNOPSIS
.nf
\fBmonthly_wfs \fP [-v] [-V] [-n] 
        [-p \fIpf\fP] [-m \fImail_to\fP]  
        \fIYYYY [ MM ]  || all || recent \fP
.fi
.SH DESCRIPTION
\fBmonthly_wfs\fP builds a list of year/day waveform directories and then runs \fBminiseed2db\fP to
build wfdiscs.  The assumption is that there is a waveform repository which contains 
all waveforms for the TA.  Wfdiscs are created for each year in the repository by \fBmonthly_wfs\fP, 
one month at a time.  There is also a one month long event database which needs wfdiscs built off the 
same repository to minimize disk usage. 

Time windows to be operated on are specified by arguement values of YYYY, MM, or "all", or "recent" (preferred and faster).

The programs or functions executed by \fBmonthly_wfs\fP are:

.IP \fBminiseed2db\fP
builds \fIevdirbase/YYYY_MM/dbbase_YYYY_MM\fP wfdisc of data collected from  \fIwfdirbase\fP. 
In the process the wfdisc dir field is set to its absolute path, and the 
lastid,snetsta,schanloc tables are removed.
.IP \fBabspath\fP
converts dir field from relative path generated by miniseed2db to absolute path
.IP \fBdbfixchanids\fP
fix chanids in db
.IP \fBdbset\fP
sets calib, calper, and segtype
.IP \fBrt_daily_return\fP
builds \fIevdirbase/YYYY_MM/dbbase_YYYY_MM\fP gap, netperf, and chanperf tables.  Also a 
\fIrtdirbase/YYYY_MM/dbbase_YYYY_MM\fP descriptor file is created immediately before this step.

.LP

.SH OPTIONS
.IP -v
verbose
.IP -V
Extremely verbose.  Used for debugging purposes only.
.IP -n
Test mode.  Does not execute commands.
.IP "-p parameter_file"
Name of parameter file to use.  $PFPATH is searched to find parameter file.
The default parameter file is \fBmonthly_wfs\fP.
.IP "-m mail_to"
email address list to send results.

.SH ENVIRONMENT
needs to have sourced $ANTELOPE/setup.csh.  
.SH PARAMETER FILE
.in 2c
.ft CW
.nf
.ne 7
.IP dbbase
db basename
.IP ev_period
allowed values are "year" or "month"
.IP wf_period
allowed values are "year" or "month"

.IP ev_lag
Number of complete periods before present to allow to be processed. 
If lag is 1 in arrears, time_slice_db skips the current and immediately previous periods.

.IP evdirbase
Path name for directory base for wfdiscs of monthly waveform data.
.IP wfdirbase
Path name for directory base original realtime waveform data.

.IP dbidserver
Name of idserver to be written into descriptor file for output database to use.
.IP dbpath    
dbpath to be written into descriptor file for output database to use.
.IP dblocks
dblocking type for database
.fi
.ft R
.in
.SH EXAMPLE PARAMETER FILE
.in 2c
.ft CW
.nf

dbbase              usarray                             # db dbbasename
ev_period           month                               # allowed values are "year" or "month"
wf_period           year                                # allowed values are "year" or "month"

ev_lag              1                                   #  Number of complete periods before present to allow to be processed.
                                                        #  If lag is 1 in arrears, time_slice_db skips the current and immediately previous periods.

evdirbase           /anf/TA/dbs/event_dbs               # 
wfdirbase           /anf/TA/dbs/wfs/certified           # 

dbpath              /anf/TA/dbs/dbmaster/{usarray}:/anf/TA/dbs/dbops/{usarray}		# default dbpath
dbidserver          anfops.ucsd.edu:2498                # default dbidserver
dblocks             nfs                                 # default dblocks

.fi
.ft R
.in
.SH RETURN VALUES
0 if successful, 1 if not.
.SH "SEE ALSO"
.nf
miniseed2db(1)
dbfixchanids(1)
dbjoin(1)
dbset(1)
rt_daily_return(1)
time_slice_db(1)
.fi
.SH "BUGS AND CAVEATS"
none
.LP
.SH AUTHOR
Frank Vernon
.br
