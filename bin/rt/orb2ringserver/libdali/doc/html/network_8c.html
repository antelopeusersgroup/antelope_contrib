<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>libdali: network.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">libdali
   &#160;<span id="projectnumber">1.6</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">network.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="libdali_8h_source.html">libdali.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a8c10ccc5784a65e6efa88e9e80746a82"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="network_8c.html#a8c10ccc5784a65e6efa88e9e80746a82">dl_connect</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn)</td></tr>
<tr class="memdesc:a8c10ccc5784a65e6efa88e9e80746a82"><td class="mdescLeft">&#160;</td><td class="mdescRight">Connect to a DataLink server.  <a href="#a8c10ccc5784a65e6efa88e9e80746a82">More...</a><br/></td></tr>
<tr class="separator:a8c10ccc5784a65e6efa88e9e80746a82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b31313fabb3c66918276e87695dec16"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="network_8c.html#a5b31313fabb3c66918276e87695dec16">dl_disconnect</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn)</td></tr>
<tr class="memdesc:a5b31313fabb3c66918276e87695dec16"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disconnect a DataLink connection.  <a href="#a5b31313fabb3c66918276e87695dec16">More...</a><br/></td></tr>
<tr class="separator:a5b31313fabb3c66918276e87695dec16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bdb00c1cd5ecdbd464ee9012fa80f6d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="network_8c.html#a3bdb00c1cd5ecdbd464ee9012fa80f6d">dl_senddata</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn, void *buffer, size_t sendlen)</td></tr>
<tr class="memdesc:a3bdb00c1cd5ecdbd464ee9012fa80f6d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send arbitrary data to a DataLink server.  <a href="#a3bdb00c1cd5ecdbd464ee9012fa80f6d">More...</a><br/></td></tr>
<tr class="separator:a3bdb00c1cd5ecdbd464ee9012fa80f6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15eee68e254a3fc494acfd51ae623c70"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="network_8c.html#a15eee68e254a3fc494acfd51ae623c70">dl_sendpacket</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn, void *headerbuf, size_t headerlen, void *databuf, size_t datalen, void *respbuf, int resplen)</td></tr>
<tr class="memdesc:a15eee68e254a3fc494acfd51ae623c70"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create and send a DataLink packet.  <a href="#a15eee68e254a3fc494acfd51ae623c70">More...</a><br/></td></tr>
<tr class="separator:a15eee68e254a3fc494acfd51ae623c70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa38aa90808beee57585044aab4c8e817"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="network_8c.html#aa38aa90808beee57585044aab4c8e817">dl_recvdata</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn, void *buffer, size_t readlen, uint8_t blockflag)</td></tr>
<tr class="memdesc:aa38aa90808beee57585044aab4c8e817"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive arbitrary data from a DataLink server.  <a href="#aa38aa90808beee57585044aab4c8e817">More...</a><br/></td></tr>
<tr class="separator:aa38aa90808beee57585044aab4c8e817"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9965316177619f3588cdd22b78899bd1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="network_8c.html#a9965316177619f3588cdd22b78899bd1">dl_recvheader</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn, void *buffer, size_t buflen, uint8_t blockflag)</td></tr>
<tr class="memdesc:a9965316177619f3588cdd22b78899bd1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive DataLink packet header.  <a href="#a9965316177619f3588cdd22b78899bd1">More...</a><br/></td></tr>
<tr class="separator:a9965316177619f3588cdd22b78899bd1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Network communication routines for DataLink</p>
<dl class="section author"><dt>Author</dt><dd>Chad Trabant, IRIS Data Management Center</dd></dl>
<p>Version: 2013.210 </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a8c10ccc5784a65e6efa88e9e80746a82"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_connect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Connect to a DataLink server. </p>
<p>Open a network socket connection to a Datalink server and set 'dlconn-&gt;link' to the new descriptor. Expects 'dlconn-&gt;addr' to be in 'host:port' format. Either the host, port or both are optional, if the host is not specified 'localhost' is assumed, if the port is not specified '16000' is assumed, if neither is specified (only a colon) then 'localhost' and port '16000' are assumed.</p>
<p>If a permanent error is detected (invalid port specified) the dlconn-&gt;terminate flag will be set so the <a class="el" href="connection_8c.html#accca46f231c23fd495bb6d5725e97957" title="Collect packets streaming from the DataLink server. ">dl_collect()</a> family of routines will not continue trying to connect.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DataLink Connection Parameters</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the socket descriptor created. </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>on errors </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a5b31313fabb3c66918276e87695dec16"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dl_disconnect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disconnect a DataLink connection. </p>
<p>Close the network socket associated with connection and set 'dlconn-&gt;link' to -1.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DataLink Connection Parameters </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="aa38aa90808beee57585044aab4c8e817"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_recvdata </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>readlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>blockflag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receive arbitrary data from a DataLink server. </p>
<p>This fundamental routine is used by other library routines to receive data from a DataLink server. Up to <em>readlen</em> bytes of received data is placed into <em>buffer</em>.</p>
<p>If <em>blockflag</em> is true (1) this function will block until <em>readlen</em> bytes have been read. If <em>blockflag</em> is false (0) and no data is available for reading this function will immediately return. If <em>blockflag</em> is false and some initial data is received the function will block until <em>readlen</em> bytes have been read.</p>
<p>If a user specified network I/O timeout was not applied at the system socket level this routine will implement the timeout using an alarm timer to interrupt the blocked send.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DataLink Connection Parameters </td></tr>
    <tr><td class="paramname">buffer</td><td>Buffer for received data </td></tr>
    <tr><td class="paramname">readlen</td><td>Number of bytes to read and place into <em>buffer</em> </td></tr>
    <tr><td class="paramname">blockflag</td><td>Flag to control use of blocking versus non-blocking mode</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of bytes read on success </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>when no data available on non-blocking socket </td></tr>
    <tr><td class="paramname">-1</td><td>on connection shutdown </td></tr>
    <tr><td class="paramname">-2</td><td>on error. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a9965316177619f3588cdd22b78899bd1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_recvheader </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>buflen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>blockflag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receive DataLink packet header. </p>
<p>Receive a DataLink packet header and place it into <em>buffer</em> up to <em>buflen</em> bytes in length.</p>
<p>The header body returned in <em>buffer</em> will always be NULL terminated. The buffer must be at least 255 bytes in size. The maximum header length is effectively 254 bytes.</p>
<dl class="section return"><dt>Returns</dt><dd>number of bytes read on success </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>when no data available on non-blocking socket </td></tr>
    <tr><td class="paramname">-1</td><td>on connection shutdown </td></tr>
    <tr><td class="paramname">-2</td><td>on error. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a3bdb00c1cd5ecdbd464ee9012fa80f6d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_senddata </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>sendlen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send arbitrary data to a DataLink server. </p>
<p>This fundamental routine is used by other library routines to send data via a DataLink connection. Before data is sent the socket to set to blocking mode and back to non-blocking before returning unless there was an error in which case the socket should be disconnected.</p>
<p>If a user specified network I/O timeout was not applied at the system socket level this routine will implement the timeout using an alarm timer to interrupt the blocked send.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DataLink Connection Parameters </td></tr>
    <tr><td class="paramname">buffer</td><td>Buffer containing data to send </td></tr>
    <tr><td class="paramname">sendlen</td><td>Number of bytes to send from buffer</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success </td></tr>
    <tr><td class="paramname">-1</td><td>on error. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a15eee68e254a3fc494acfd51ae623c70"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_sendpacket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>headerbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>headerlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>databuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>datalen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>respbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>resplen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create and send a DataLink packet. </p>
<p>Send a DataLink packet created by combining an appropriate preheader with <em>headerbuf</em> and, optionally, <em>databuf</em>.</p>
<p>The header length must be larger than 0 but the packet length can be 0 resulting in a header-only packet, commonly used for sending commands.</p>
<p>If the response buffer <em>respbuf</em> is not NULL then read up to <em>resplen</em> bytes into <em>respbuf</em> using <a class="el" href="libdali_8h.html#a9965316177619f3588cdd22b78899bd1" title="Receive DataLink packet header. ">dl_recvheader()</a> after sending the packet. This is only designed for small pieces of data, specifically the server acknowledgement to a command, which are a header-only packets.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DataLink Connection Parameters </td></tr>
    <tr><td class="paramname">headerbuf</td><td>Buffer containing DataLink packet header </td></tr>
    <tr><td class="paramname">headerlen</td><td>Length of header buffer to send </td></tr>
    <tr><td class="paramname">databuf</td><td>Buffer containing DataLink packet data </td></tr>
    <tr><td class="paramname">datalen</td><td>Length of data buffer to send </td></tr>
    <tr><td class="paramname">respbuf</td><td>Buffer to place response from server </td></tr>
    <tr><td class="paramname">resplen</td><td>Length of response buffer</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of bytes of response received </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success and <em>respbuf</em> is NULL </td></tr>
    <tr><td class="paramname">-1</td><td>on error </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Aug 1 2013 16:58:33 for libdali by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.4
</small></address>
</body>
</html>
