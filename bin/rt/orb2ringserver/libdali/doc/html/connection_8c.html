<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>libdali: connection.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">libdali
   &#160;<span id="projectnumber">1.6</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">connection.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="libdali_8h_source.html">libdali.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="portable_8h_source.html">portable.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a663e07d45c7acd0377b5f1f4d930b5a7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a663e07d45c7acd0377b5f1f4d930b5a7">dl_newdlcp</a> (char *address, char *progname)</td></tr>
<tr class="memdesc:a663e07d45c7acd0377b5f1f4d930b5a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new DataLink Connection Parameter (DLCP) structure.  <a href="#a663e07d45c7acd0377b5f1f4d930b5a7">More...</a><br/></td></tr>
<tr class="separator:a663e07d45c7acd0377b5f1f4d930b5a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7603e72f54c34879f86c319239a50e52"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a7603e72f54c34879f86c319239a50e52">dl_freedlcp</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn)</td></tr>
<tr class="memdesc:a7603e72f54c34879f86c319239a50e52"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free a DataLink Connection Parameter (DLCP) structure.  <a href="#a7603e72f54c34879f86c319239a50e52">More...</a><br/></td></tr>
<tr class="separator:a7603e72f54c34879f86c319239a50e52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38b35bee3faee3f24543feda8ecc3a6c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a38b35bee3faee3f24543feda8ecc3a6c">dl_exchangeIDs</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn, int parseresp)</td></tr>
<tr class="memdesc:a38b35bee3faee3f24543feda8ecc3a6c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send the ID command to the DataLink server and parse response.  <a href="#a38b35bee3faee3f24543feda8ecc3a6c">More...</a><br/></td></tr>
<tr class="separator:a38b35bee3faee3f24543feda8ecc3a6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a823f483f8492e0317a5221c3f02b13d0"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a823f483f8492e0317a5221c3f02b13d0">dl_position</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn, int64_t pktid, <a class="el" href="libdali_8h.html#ad46ecd16ed2b512a60d5f948fa15a31f">dltime_t</a> pkttime)</td></tr>
<tr class="memdesc:a823f483f8492e0317a5221c3f02b13d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Position the client read position.  <a href="#a823f483f8492e0317a5221c3f02b13d0">More...</a><br/></td></tr>
<tr class="separator:a823f483f8492e0317a5221c3f02b13d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8bc14b495d971ea3b119bfc3796b00f"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#ab8bc14b495d971ea3b119bfc3796b00f">dl_position_after</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn, <a class="el" href="libdali_8h.html#ad46ecd16ed2b512a60d5f948fa15a31f">dltime_t</a> datatime)</td></tr>
<tr class="memdesc:ab8bc14b495d971ea3b119bfc3796b00f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Position the client read position based on data time.  <a href="#ab8bc14b495d971ea3b119bfc3796b00f">More...</a><br/></td></tr>
<tr class="separator:ab8bc14b495d971ea3b119bfc3796b00f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a7501ffdf01f73f8e5b1c1b9ca29843"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a0a7501ffdf01f73f8e5b1c1b9ca29843">dl_match</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn, char *matchpattern)</td></tr>
<tr class="memdesc:a0a7501ffdf01f73f8e5b1c1b9ca29843"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the packet match parameters for a connection.  <a href="#a0a7501ffdf01f73f8e5b1c1b9ca29843">More...</a><br/></td></tr>
<tr class="separator:a0a7501ffdf01f73f8e5b1c1b9ca29843"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affcdbcae2611a8c6208243bc2a418149"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#affcdbcae2611a8c6208243bc2a418149">dl_reject</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn, char *rejectpattern)</td></tr>
<tr class="memdesc:affcdbcae2611a8c6208243bc2a418149"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the packet reject parameters for a connection.  <a href="#affcdbcae2611a8c6208243bc2a418149">More...</a><br/></td></tr>
<tr class="separator:affcdbcae2611a8c6208243bc2a418149"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a21194a1a308eb91db0d32bced621f8"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a6a21194a1a308eb91db0d32bced621f8">dl_write</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn, void *packet, int packetlen, char *streamid, <a class="el" href="libdali_8h.html#ad46ecd16ed2b512a60d5f948fa15a31f">dltime_t</a> datastart, <a class="el" href="libdali_8h.html#ad46ecd16ed2b512a60d5f948fa15a31f">dltime_t</a> dataend, int ack)</td></tr>
<tr class="memdesc:a6a21194a1a308eb91db0d32bced621f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a packet to the DataLink server.  <a href="#a6a21194a1a308eb91db0d32bced621f8">More...</a><br/></td></tr>
<tr class="separator:a6a21194a1a308eb91db0d32bced621f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a49f3842de1a14030b20e665bfcbf31"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a9a49f3842de1a14030b20e665bfcbf31">dl_read</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn, int64_t pktid, <a class="el" href="libdali_8h.html#a70c9a6e47c1fa2c1846b498154f118f8">DLPacket</a> *packet, void *packetdata, size_t maxdatasize)</td></tr>
<tr class="memdesc:a9a49f3842de1a14030b20e665bfcbf31"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request a packet from the DataLink server.  <a href="#a9a49f3842de1a14030b20e665bfcbf31">More...</a><br/></td></tr>
<tr class="separator:a9a49f3842de1a14030b20e665bfcbf31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a812ede0c3d5e15ab118c489087b01260"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a812ede0c3d5e15ab118c489087b01260">dl_getinfo</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn, const char *infotype, char *infomatch, char **infodata, size_t maxinfosize)</td></tr>
<tr class="memdesc:a812ede0c3d5e15ab118c489087b01260"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request information from the DataLink server.  <a href="#a812ede0c3d5e15ab118c489087b01260">More...</a><br/></td></tr>
<tr class="separator:a812ede0c3d5e15ab118c489087b01260"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:accca46f231c23fd495bb6d5725e97957"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#accca46f231c23fd495bb6d5725e97957">dl_collect</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn, <a class="el" href="libdali_8h.html#a70c9a6e47c1fa2c1846b498154f118f8">DLPacket</a> *packet, void *packetdata, size_t maxdatasize, int8_t endflag)</td></tr>
<tr class="memdesc:accca46f231c23fd495bb6d5725e97957"><td class="mdescLeft">&#160;</td><td class="mdescRight">Collect packets streaming from the DataLink server.  <a href="#accca46f231c23fd495bb6d5725e97957">More...</a><br/></td></tr>
<tr class="separator:accca46f231c23fd495bb6d5725e97957"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1343fa010d7cce001da5fb4a231dcd7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#aa1343fa010d7cce001da5fb4a231dcd7">dl_collect_nb</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn, <a class="el" href="libdali_8h.html#a70c9a6e47c1fa2c1846b498154f118f8">DLPacket</a> *packet, void *packetdata, size_t maxdatasize, int8_t endflag)</td></tr>
<tr class="memdesc:aa1343fa010d7cce001da5fb4a231dcd7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Collect packets streaming from the DataLink server without blocking.  <a href="#aa1343fa010d7cce001da5fb4a231dcd7">More...</a><br/></td></tr>
<tr class="separator:aa1343fa010d7cce001da5fb4a231dcd7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28610d15c30459cb171beaa6954798a4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a28610d15c30459cb171beaa6954798a4">dl_handlereply</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn, void *buffer, int buflen, int64_t *value)</td></tr>
<tr class="memdesc:a28610d15c30459cb171beaa6954798a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle the server reply to a command.  <a href="#a28610d15c30459cb171beaa6954798a4">More...</a><br/></td></tr>
<tr class="separator:a28610d15c30459cb171beaa6954798a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa357699d12a48e074de595f30e3565fb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#aa357699d12a48e074de595f30e3565fb">dl_terminate</a> (<a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *dlconn)</td></tr>
<tr class="memdesc:aa357699d12a48e074de595f30e3565fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the terminate parameter of a DataLink connection.  <a href="#aa357699d12a48e074de595f30e3565fb">More...</a><br/></td></tr>
<tr class="separator:aa357699d12a48e074de595f30e3565fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Routines for managing a connection with a DataLink server.</p>
<dl class="section author"><dt>Author</dt><dd>Chad Trabant, IRIS Data Management Center</dd></dl>
<p>modified: 2013.210 </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="accca46f231c23fd495bb6d5725e97957"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_collect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#a70c9a6e47c1fa2c1846b498154f118f8">DLPacket</a> *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>packetdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>maxdatasize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int8_t&#160;</td>
          <td class="paramname"><em>endflag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Collect packets streaming from the DataLink server. </p>
<p>Collect packets streaming from the DataLink server. If the connection is not already in streaming mode the STREAM command will first be sent. This routine will block until a packet is received sending keepalive packets to the server based on the <a class="el" href="struct_d_l_c_p__s.html#a18b17b1a0c656eea9469e934746c9049">DLCP.keepalive</a> parameter.</p>
<p>Designed to run in a tight loop at the heart of a client program, this function will return every time a packet is received. On successfully receiving a packet <em>dlpack</em> will be populated and the packet data will be copied into <em>packetdata</em>.</p>
<p>If the endflag is true the ENDSTREAM command is sent which instructs the server to stop streaming packets; a client must continue collecting packets until DLENDED is returned in order to get any packets that were in-the-air when ENDSTREAM was requested. The stream ending sequence must be completed if the connection is to be used after streaming mode.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">DLPACKET</td><td>when a packet is received. </td></tr>
    <tr><td class="paramname">DLENDED</td><td>when the stream ending sequence was completed or the connection was shut down. </td></tr>
    <tr><td class="paramname">DLERROR</td><td>when an error occurred. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="aa1343fa010d7cce001da5fb4a231dcd7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_collect_nb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#a70c9a6e47c1fa2c1846b498154f118f8">DLPacket</a> *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>packetdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>maxdatasize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int8_t&#160;</td>
          <td class="paramname"><em>endflag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Collect packets streaming from the DataLink server without blocking. </p>
<p>Collect packets streaming from the DataLink server. If the connection is not already in streaming mode the STREAM command will first be sent. This routine is a non-blocking version of <a class="el" href="connection_8c.html#accca46f231c23fd495bb6d5725e97957" title="Collect packets streaming from the DataLink server. ">dl_collect()</a> and will return quickly whether data is received or not. Keep alive packets are sent to the server based on the <a class="el" href="struct_d_l_c_p__s.html#a18b17b1a0c656eea9469e934746c9049">DLCP.keepalive</a> parameter.</p>
<p>Designed to run in a tight loop at the heart of a client program, this function will return every time a packet is received. On successfully receiving a packet <em>dlpack</em> will be populated and the packet data will be copied into <em>packetdata</em>.</p>
<p>If the <em>endflag</em> is true the ENDSTREAM command is sent which instructs the server to stop streaming packets; a client must continue collecting packets until DLENDED is returned in order to get any packets that were in-the-air when ENDSTREAM was requested. The stream ending sequence must be completed if the connection is to be used after streaming mode.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">DLPACKET</td><td>A packet is received. </td></tr>
    <tr><td class="paramname">DLNOPACKET</td><td>No packet is received. </td></tr>
    <tr><td class="paramname">DLENDED</td><td>when the stream ending sequence was completed or the connection was shut down. </td></tr>
    <tr><td class="paramname">DLERROR</td><td>when an error occurred. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a38b35bee3faee3f24543feda8ecc3a6c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_exchangeIDs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>parseresp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send the ID command to the DataLink server and parse response. </p>
<p>Send the ID command including the client ID and optionally parse the capability flags from the server response. This routine is always called when a connection is first made using <a class="el" href="libdali_8h.html#a8c10ccc5784a65e6efa88e9e80746a82" title="Connect to a DataLink server. ">dl_connect()</a> and shouldn't normally need to be called again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DataLink Connection Parameters </td></tr>
    <tr><td class="paramname">parseresp</td><td>Flag to control parsing of server response.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>-1 on errors, 0 on success. </dd></dl>

</div>
</div>
<a class="anchor" id="a7603e72f54c34879f86c319239a50e52"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dl_freedlcp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free a DataLink Connection Parameter (DLCP) structure. </p>
<p>Free all memory associated with a DLCP struct.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DLCP to free </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a812ede0c3d5e15ab118c489087b01260"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_getinfo </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>infotype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>infomatch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>infodata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>maxinfosize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Request information from the DataLink server. </p>
<p>Request and receive information from the server using the DataLink INFO command. The INFO response is placed in the supplied <em>infodata</em> buffer. All DataLink INFO responses are returned as XML.</p>
<p>If <em>maxinfosize</em> argument is 0 memory will be allocated as needed for the INFO data result and the infodata pointer will be set to this new buffer; it is up to the caller to free this memory. If an infomatch string is supplied it will be appended to the INFO request sent to the server.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DataLink Connection Parameters </td></tr>
    <tr><td class="paramname">infotype</td><td>The INFO type to request </td></tr>
    <tr><td class="paramname">infomatch</td><td>An optional match pattern </td></tr>
    <tr><td class="paramname">infodata</td><td>Buffer to place the INFO response into </td></tr>
    <tr><td class="paramname">maxinfosize</td><td>Maximum number of bytes to write to <em>infodata</em> buffer</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The length of the INFO response in bytes on success and -1 on error. </dd></dl>

</div>
</div>
<a class="anchor" id="a28610d15c30459cb171beaa6954798a4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_handlereply </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>buflen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t *&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handle the server reply to a command. </p>
<p>Handle the server reply to a command. This routine is used by other library routines to process replies from the server.</p>
<p>Server replies are of the form:</p>
<p>"OK|ERROR value size"</p>
<p>followed by an optional server message of size bytes. If size is greater than zero it will be read from the connection and placed into <em>buffer</em>. The server message, if included, will always be a NULL-terminated string.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>Error </td></tr>
    <tr><td class="paramname">0</td><td>"OK" received </td></tr>
    <tr><td class="paramname">1</td><td>"ERROR" received </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a0a7501ffdf01f73f8e5b1c1b9ca29843"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t dl_match </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>matchpattern</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the packet match parameters for a connection. </p>
<p>Send new match pattern to server or reset matching. If <em>matchpattern</em> is NULL a zero length pattern command is sent to the server which resets the client matching setting.</p>
<p>The packet match pattern limits which packets are sent to the client in streaming mode, this is the mode used for <a class="el" href="connection_8c.html#accca46f231c23fd495bb6d5725e97957" title="Collect packets streaming from the DataLink server. ">dl_collect()</a> and <a class="el" href="connection_8c.html#aa1343fa010d7cce001da5fb4a231dcd7" title="Collect packets streaming from the DataLink server without blocking. ">dl_collect_nb()</a> requests.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DataLink Connection Parameters </td></tr>
    <tr><td class="paramname">matchpattern</td><td>Match regular expression</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the count of currently matched streams on success and -1 on error. </dd></dl>

</div>
</div>
<a class="anchor" id="a663e07d45c7acd0377b5f1f4d930b5a7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a>* dl_newdlcp </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>progname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a new DataLink Connection Parameter (DLCP) structure. </p>
<p>Allocate, initialze and return a pointer to a new DLCP struct.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>Address of DataLink server in "host:port" format </td></tr>
    <tr><td class="paramname">progname</td><td>Name of program, usually argv[0]</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>allocated DLCP struct on success, NULL on error. </dd></dl>

</div>
</div>
<a class="anchor" id="a823f483f8492e0317a5221c3f02b13d0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t dl_position </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>pktid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ad46ecd16ed2b512a60d5f948fa15a31f">dltime_t</a>&#160;</td>
          <td class="paramname"><em>pkttime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Position the client read position. </p>
<p>Set the client read position to a specified packet ID and packet time. A packet ID and time together uniquely identify a packet in a DataLink server. The packet time must match the packet ID currently in the server's buffer or the positioning request will fail.</p>
<p>As a special case <em>pktid</em> maybe be set to <em>LIBDALI_POSITION_EARLIEST</em> or <em>LIBDALI_POSITION_LATEST</em> to set the client read position to the earliest or latest packet. In both cases the <em>pkttime</em> value is ignored.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DataLink Connection Parameters </td></tr>
    <tr><td class="paramname">pktid</td><td>Packet ID to set position to </td></tr>
    <tr><td class="paramname">pkttime</td><td>Packet time cooresponding to <em>pktid</em> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A positive packet ID on success, 0 when packet is not found and -1 on error. </dd></dl>

</div>
</div>
<a class="anchor" id="ab8bc14b495d971ea3b119bfc3796b00f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t dl_position_after </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ad46ecd16ed2b512a60d5f948fa15a31f">dltime_t</a>&#160;</td>
          <td class="paramname"><em>datatime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Position the client read position based on data time. </p>
<p>Set the client read position to the first packet with a data end time after a reference <em>datatime</em>. The reference time must be specified as a dltime_t value, see <a class="el" href="libdali_8h.html#a2deac0dfe42843e14d9e79e537061b90" title="Convert specified time values to a dltime_t value. ">dl_time2dltime()</a> and friends to generate these time values.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DataLink Connection Parameters </td></tr>
    <tr><td class="paramname">datatime</td><td>Reference data time as a dltime_t value</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A positive packet ID on success and -1 on error. </dd></dl>

</div>
</div>
<a class="anchor" id="a9a49f3842de1a14030b20e665bfcbf31"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>pktid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#a70c9a6e47c1fa2c1846b498154f118f8">DLPacket</a> *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>packetdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>maxdatasize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Request a packet from the DataLink server. </p>
<p>Request a specific packet from the server.</p>
<p>A maximum of <em>maxdatasize</em> will be written to <em>packetdata</em>. If the packet data is larger than this maximum size an error will be logged and 0 will be returned; the packet data will be recv'd and discarded in order to leave the connection in a usable state.</p>
<p>If this routine returns -1 the connection should be considered to be in a bad state and should be shut down.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DataLink Connection Parameters </td></tr>
    <tr><td class="paramname">pktid</td><td>Packet ID to request </td></tr>
    <tr><td class="paramname">packet</td><td>Pointer to a DLPacket struct for the received packet header information </td></tr>
    <tr><td class="paramname">packetdata</td><td>Pointer to a buffer for received packet data </td></tr>
    <tr><td class="paramname">maxdatasize</td><td>Maximum data size to write to <em>packetdata</em> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Number of bytes of packet data received on success and -1 on error. </dd></dl>

</div>
</div>
<a class="anchor" id="affcdbcae2611a8c6208243bc2a418149"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t dl_reject </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>rejectpattern</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the packet reject parameters for a connection. </p>
<p>Send new reject pattern to server or reset rejecting. If <em>rejectpattern</em> is NULL a zero length pattern command is sent to the server which resets the client rejecting setting.</p>
<p>The packet reject pattern limits which packets are sent to the client in streaming mode, this is the mode used for <a class="el" href="connection_8c.html#accca46f231c23fd495bb6d5725e97957" title="Collect packets streaming from the DataLink server. ">dl_collect()</a> and <a class="el" href="connection_8c.html#aa1343fa010d7cce001da5fb4a231dcd7" title="Collect packets streaming from the DataLink server without blocking. ">dl_collect_nb()</a> requests.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DataLink Connection Parameters </td></tr>
    <tr><td class="paramname">rejectpattern</td><td>Reject regular expression</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the count of currently rejected streams on success and -1 on error. </dd></dl>

</div>
</div>
<a class="anchor" id="aa357699d12a48e074de595f30e3565fb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dl_terminate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the terminate parameter of a DataLink connection. </p>
<p>Set the terminate parameter/flag in the <em>DLCP</em> and log a diagnostic message indicating that the connection is terminating. Some of the library routines watch the terminate parameter as an indication that the client program is requesting a shut down. This routine is typically used in a signal handler. </p>

</div>
</div>
<a class="anchor" id="a6a21194a1a308eb91db0d32bced621f8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t dl_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ae768dd9d45bedc419d16380a12c04709">DLCP</a> *&#160;</td>
          <td class="paramname"><em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>packetlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>streamid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ad46ecd16ed2b512a60d5f948fa15a31f">dltime_t</a>&#160;</td>
          <td class="paramname"><em>datastart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="libdali_8h.html#ad46ecd16ed2b512a60d5f948fa15a31f">dltime_t</a>&#160;</td>
          <td class="paramname"><em>dataend</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ack</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a packet to the DataLink server. </p>
<p>Send a packet to the server and optionally request and process an acknowledgement from the server. An appropriate DataLink packet header is created from the supplied parameters and sent with the packet data.</p>
<p>When an acknowledgement from the server has been requested this routine will receive the response from the server and parse it, a successful acknowledgement is indicated by the return value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dlconn</td><td>DataLink Connection Parameters </td></tr>
    <tr><td class="paramname">packet</td><td>Packet data buffer to send </td></tr>
    <tr><td class="paramname">packetlen</td><td>Length of data in bytes to send from <em>packet</em> </td></tr>
    <tr><td class="paramname">streamid</td><td>Stream ID of packet </td></tr>
    <tr><td class="paramname">datastart</td><td>Data start time for packet </td></tr>
    <tr><td class="paramname">dataend</td><td>Data end time for packet </td></tr>
    <tr><td class="paramname">ack</td><td>Acknowledgement flag, if true request acknowledgement</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>-1 on error and 0 on success when no acknowledgement is requested and a positive packet ID on success when acknowledgement is requested. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Aug 1 2013 16:58:33 for libdali by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.4
</small></address>
</body>
</html>
